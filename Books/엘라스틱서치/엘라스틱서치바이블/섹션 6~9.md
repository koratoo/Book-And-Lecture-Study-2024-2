# 목차
- [06장: 클러스터 운영](#06장-클러스터-운영)
  - [6.1 클러스터 설정 API](#61-클러스터-설정-api)
  - [6.2 cat API를 통한 클러스터 관리와 모니터링](#62-cat-api를-통한-클러스터-관리와-모니터링)
  - [6.3 인덱스 운영 전략](#63-인덱스-운영-전략)
    - [6.3.1 템플릿과 명시적 매핑 활용](#631-템플릿과-명시적-매핑-활용)
    - [6.3.2 라우팅 활용](#632-라우팅-활용)
    - [6.3.3 시계열 인덱스 이름](#633-시계열-인덱스-이름)
    - [6.3.4 alias](#634-alias)
    - [6.3.5 롤오버](#635-롤오버)
    - [6.3.6 데이터 스트림](#636-데이터-스트림)
    - [6.3.7 reindex](#637-reindex)
    - [6.3.8 shrink로 샤드 개수 줄이기](#638-shrink로-샤드-개수-줄이기)
    - [6.3.9 split으로 샤드 개수 늘리기](#639-split으로-샤드-개수-늘리기)
    - [6.3.10 다중 필드](#6310-다중-필드)
    - [6.3.11 타입이 계속 변경되는 데이터](#6311-타입이-계속-변경되는-데이터)
    - [6.3.12 루씬 텀 길이 제약](#6312-루씬-텀-길이-제약)
    - [6.3.13 대량 색인이 필요할 때](#6313-대량-색인이-필요할-때)
  - [6.4 샤드 운영 전략](#64-샤드-운영-전략)
    - [6.4.1 샤드의 크기와 개수 조정](#641-샤드의-크기와-개수-조정)
    - [6.4.2 모든 노드가 충분히 일을 하고 있는지](#642-모든-노드가-충분히-일을-하고-있는지)
    - [6.4.3 미래에 데이터가 커질 것을 고려](#643-미래에-데이터가-커질-것을-고려)
    - [6.4.4 테스트 수행](#644-테스트-수행)
  - [6.5 롤링 리스타트](#65-롤링-리스타트)
  - [6.6 스냅샷과 복구](#66-스냅샷과-복구)
    - [6.6.1 스냅샷 저장소 등록과 설정](#661-스냅샷-저장소-등록과-설정)
    - [6.6.2 스냅샷을 생성하고 조회하기](#662-스냅샷을-생성하고-조회하기)
    - [6.6.3 스냅샷에서 인덱스 복구하기](#663-스냅샷에서-인덱스-복구하기)
    - [6.6.4 스냅샷 삭제하기](#664-스냅샷-삭제하기)
    - [6.6.5 스냅샷 생명 주기 관리](#665-스냅샷-생명-주기-관리)
  - [6.7 명시적으로 세그먼트 병합하기](#67-명시적으로-세그먼트-병합하기)
  - [6.8 샤드 할당 필터링과 데이터 티어 구조](#68-샤드-할당-필터링과-데이터-티어-구조)
    - [6.8.1 노드 속성과 샤드 할당 의식](#681-노드-속성과-샤드-할당-의식)
    - [6.8.2 클러스터 단위 샤드 할당 필터링](#682-클러스터-단위-샤드-할당-필터링)
    - [6.8.3 인덱스 단위 샤드 할당 필터링](#683-인덱스-단위-샤드-할당-필터링)
    - [6.8.4 데이터 티어 구조](#684-데이터-티어-구조)
  - [6.9 인덱스 생명 주기 관리](#69-인덱스-생명-주기-관리)
  - [6.10 서킷 브레이커](#610-서킷-브레이커)
  - [6.11 슬로우 로그 설정](#611-슬로우-로그-설정)
  - [6.12 버전 업그레이드](#612-버전-업그레이드)
    - [6.12.1 사전에 챙겨야 할 사항](#6121-사전에-챙겨야-할-사항)
    - [6.12.2 롤링 업그레이드](#6122-롤링-업그레이드)
    - [6.12.3 풀 리스타트 업그레이드](#6123-풀-리스타트-업그레이드)
    - [6.12.4 엘라스틱 스택 업그레이드](#6124-엘라스틱-스택-업그레이드)
- [07장: 운영 도중 발생하는 장애 대응](#07장-운영-도중-발생하는-장애-대응)
  - [7.1 장애 징후 탐지를 위한 사전 모니터링 등록](#71-장애-징후-탐지를-위한-사전-모니터링-등록)
    - [7.1.1 메트릭비트로 지표 데이터를 수집하고 스택 모니터링으로 확인하기](#711-메트릭비트로-지표-데이터를-수집하고-스택-모니터링으로-확인하기)
    - [7.1.2 키바나의 얼럿 기능으로 알람 받기](#712-키바나의-얼럿-기능으로-알람-받기)
    - [7.1.3 다른 대안으로 구성하기](#713-다른-대안으로-구성하기)
  - [7.2 장애 발생 시 대응](#72-장애-발생-시-대응)
  - [7.3 자주 발생하는 장애 유형](#73-자주-발생하는-장애-유형)
    - [7.3.1 키바나에서 과도한 요청 인입](#731-키바나에서-과도한-요청-인입)
    - [7.3.2 GC로 인한 stop-the-world 상황](#732-gc로-인한-stop-the-world-상황)
    - [7.3.3 디스크 풀 상황](#733-디스크-풀-상황)
    - [7.3.4 미할당 샤드가 남았는데 샤드 할당이 더 이상 진행되지 않는 상황](#734-미할당-샤드가-남았는데-샤드-할당이-더-이상-진행되지-않는-상황)
    - [7.3.5 댕글링 인덱스](#735-댕글링-인덱스)
    - [7.3.6 장애 복구 작업 도중 새 인덱스가 생성될 때](#736-장애-복구-작업-도중-새-인덱스가-생성될-때)
    - [7.3.7 날짜가 넘어가는 순간에 대량으로 새 인덱스가 생성되며 부하가 몰려 죽는 상황](#737-날짜가-넘어가는-순간에-대량으로-새-인덱스가-생성되며-부하가-몰려-죽는-상황)
    - [7.3.8 특정 노드의 성능이 떨어지는 상황](#738-특정-노드의-성능이-떨어지는-상황)
  - [7.4 샤드 복구 전략](#74-샤드-복구-전략)
    - [7.4.1 샤드 복구 기본](#741-샤드-복구-기본)
    - [7.4.2 샤드 복구 진행 상황 확인](#742-샤드-복구-진행-상황-확인)
    - [7.4.3 샤드 복구 속도 조정](#743-샤드-복구-속도-조정)
    - [7.4.4 샤드 복구 우선순위 조정](#744-샤드-복구-우선순위-조정)
  - [7.5 원활한 장애 복구를 위한 서비스 구조 설계](#75-원활한-장애-복구를-위한-서비스-구조-설계)
    - [7.5.1 앞쪽에 메시지 큐를 둔다](#751-앞쪽에-메시지-큐를-둔다)
    - [7.5.2 멱등하게 설계한다](#752-멱등하게-설계한다)
    - [7.5.3 용도나 중요도별로 클러스터를 분리해야 한다](#753-용도나-중요도별로-클러스터를-분리해야-한다)
- [08장: 엘라스틱서치의 내부 동작 상세](#08장-엘라스틱서치의-내부-동작-상세)
  - [8.1 엘라스틱서치의 데이터 분산 처리 과정](#81-엘라스틱서치의-데이터-분산-처리-과정)
    - [8.1.1 쓰기 작업 시 엘라스틱서치 동작과 동시성 제어](#811-쓰기-작업-시-엘라스틱서치-동작과-동시성-제어)
    - [8.1.2 읽기 작업 시 엘라스틱서치 동작](#812-읽기-작업-시-엘라스틱서치-동작)
    - [8.1.3 체크포인트와 샤드 복구 과정](#813-체크포인트와-샤드-복구-과정)
  - [8.2 엘라스틱서치의 검색 동작 상세](#82-엘라스틱서치의-검색-동작-상세)
    - [8.2.1 엘라스틱서치 검색 동작 흐름](#821-엘라스틱서치-검색-동작-흐름)
    - [8.2.2 루씬 쿼리의 매칭과 스코어링 과정](#822-루씬-쿼리의-매칭과-스코어링-과정)
    - [8.2.3 캐시 동작](#823-캐시-동작)
- [09장: 커스텀 플러그인을 이용한 엘라스틱서치 커스터마이징과 실전 운영](#09장-커스텀-플러그인을-이용한-엘라스틱서치-커스터마이징과-실전-운영)
  - [9.1 커스텀 플러그인이 필요한 이유](#91-커스텀-플러그인이-필요한-이유)
  - [9.2 플러그인 기본](#92-플러그인-기본)
    - [9.2.1 플러그인 기본 관리](#921-플러그인-기본-관리)
    - [9.2.2 플러그인 기본 구조](#922-플러그인-기본-구조)
    - [9.2.3 플러그인 개발 시 유의할 사항](#923-플러그인-개발-시-유의할-사항)
  - [9.3 Hello World 플러그인 제작](#93-hello-world-플러그인-제작)
    - [9.3.1 플러그인 프로젝트 생성과 기본 구조 잡기](#931-플러그인-프로젝트-생성과-기본-구조-잡기)
    - [9.3.2 Plugin과 ActionPlugin](#932-plugin과-actionplugin)
  - [9.4 엘라스틱서치와 플러그인의 테스트 코드 작성](#94-엘라스틱서치와-플러그인의-테스트-코드-작성)
    - [9.4.1 테스트 코드 작성을 위한 기본 설정](#941-테스트-코드-작성을-위한-기본-설정)
    - [9.4.2 엘라스틱서치 테스트 프레임워크로 테스트 코드 작성](#942-엘라스틱서치-테스트-프레임워크로-테스트-코드-작성)
    - [9.4.3 REST 레이어 테스트](#943-rest-레이어-테스트)
  - [9.5 ActionFilter로 위험한 액션 차단 및 변조하기](#95-actionfilter로-위험한-액션-차단-및-변조하기)
    - [9.5.1 ActionFilter를 사용하는 플러그인 구현](#951-actionfilter를-사용하는-플러그인-구현)
    - [9.5.2 엘라스틱서치 기동 과정과 ActionFilter의 동작 상세](#952-엘라스틱서치-기동-과정과-actionfilter의-동작-상세)
    - [9.5.3 createComponents로 플러그인 구성요소 등록](#953-createcomponents로-플러그인-구성요소-등록)
    - [9.5.4 LifecycleComponent로 생명 주기를 가진 구성요소 관리](#954-lifecyclecomponent로-생명-주기를-가진-구성요소-관리)
  - [9.6 특정 조건을 만족할 때를 감지하여 알람 보내기](#96-특정-조건을-만족할-때를-감지하여-알람-보내기)
    - [9.6.1 persistent 타입의 task 동작](#961-persistent-타입의-task-동작)
    - [9.6.2 PersistentTaskPlugin 구현](#962-persistenttaskplugin-구현)
    - [9.6.3 플러그인에 권한 부여하기](#963-플러그인에-권한-부여하기)
  - [9.7 인덱스 내 일부 데이터만 덤프하기](#97-인덱스-내-일부-데이터만-덤프하기)
    - [9.7.1 덤프 플러그인 작성](#971-덤프-플러그인-작성)
    - [9.7.2 플러그인에 권한을 강제로 부여하기](#972-플러그인에-권한을-강제로-부여하기)
    - [9.7.3 HDFS에 덤프](#973-hdfs에-덤프)
  - [9.8 데이터 변경분을 카프카로 발급하기](#98-데이터-변경분을-카프카로-발급하기)
    - [9.8.1 IndexingOperationListener로 문서 작업 추적](#981-indexingoperationlistener로-문서-작업-추적)
    - [9.8.2 카프카로 메시지 발급](#982-카프카로-메시지-발급)

# 06장: 클러스터 운영
## 6.1 클러스터 설정 API
## 6.2 cat API를 통한 클러스터 관리와 모니터링
## 6.3 인덱스 운영 전략
### 6.3.1 템플릿과 명시적 매핑 활용
### 6.3.2 라우팅 활용
### 6.3.3 시계열 인덱스 이름
### 6.3.4 alias
### 6.3.5 롤오버
### 6.3.6 데이터 스트림
### 6.3.7 reindex
### 6.3.8 shrink로 샤드 개수 줄이기
### 6.3.9 split으로 샤드 개수 늘리기
### 6.3.10 다중 필드
### 6.3.11 타입이 계속 변경되는 데이터
### 6.3.12 루씬 텀 길이 제약
### 6.3.13 대량 색인이 필요할 때
## 6.4 샤드 운영 전략
### 6.4.1 샤드의 크기와 개수 조정
### 6.4.2 모든 노드가 충분히 일을 하고 있는지
### 6.4.3 미래에 데이터가 커질 것을 고려
### 6.4.4 테스트 수행
## 6.5 롤링 리스타트
## 6.6 스냅샷과 복구
### 6.6.1 스냅샷 저장소 등록과 설정
### 6.6.2 스냅샷을 생성하고 조회하기
### 6.6.3 스냅샷에서 인덱스 복구하기
### 6.6.4 스냅샷 삭제하기
### 6.6.5 스냅샷 생명 주기 관리
## 6.7 명시적으로 세그먼트 병합하기
## 6.8 샤드 할당 필터링과 데이터 티어 구조
### 6.8.1 노드 속성과 샤드 할당 의식
### 6.8.2 클러스터 단위 샤드 할당 필터링
### 6.8.3 인덱스 단위 샤드 할당 필터링
### 6.8.4 데이터 티어 구조
## 6.9 인덱스 생명 주기 관리
## 6.10 서킷 브레이커
## 6.11 슬로우 로그 설정
## 6.12 버전 업그레이드
### 6.12.1 사전에 챙겨야 할 사항
### 6.12.2 롤링 업그레이드
### 6.12.3 풀 리스타트 업그레이드
### 6.12.4 엘라스틱 스택 업그레이드

# 07장: 운영 도중 발생하는 장애 대응
## 7.1 장애 징후 탐지를 위한 사전 모니터링 등록
### 7.1.1 메트릭비트로 지표 데이터를 수집하고 스택 모니터링으로 확인하기
### 7.1.2 키바나의 얼럿 기능으로 알람 받기
### 7.1.3 다른 대안으로 구성하기
## 7.2 장애 발생 시 대응
## 7.3 자주 발생하는 장애 유형
### 7.3.1 키바나에서 과도한 요청 인입
### 7.3.2 GC로 인한 stop-the-world 상황
### 7.3.3 디스크 풀 상황
### 7.3.4 미할당 샤드가 남았는데 샤드 할당이 더 이상 진행되지 않는 상황
### 7.3.5 댕글링 인덱스
### 7.3.6 장애 복구 작업 도중 새 인덱스가 생성될 때
### 7.3.7 날짜가 넘어가는 순간에 대량으로 새 인덱스가 생성되며 부하가 몰려 죽는 상황
### 7.3.8 특정 노드의 성능이 떨어지는 상황
## 7.4 샤드 복구 전략
### 7.4.1 샤드 복구 기본
### 7.4.2 샤드 복구 진행 상황 확인
### 7.4.3 샤드 복구 속도 조정
### 7.4.4 샤드 복구 우선순위 조정
## 7.5 원활한 장애 복구를 위한 서비스 구조 설계
### 7.5.1 앞쪽에 메시지 큐를 둔다
### 7.5.2 멱등하게 설계한다
### 7.5.3 용도나 중요도별로 클러스터를 분리해야 한다

# 08장: 엘라스틱서치의 내부 동작 상세
## 8.1 엘라스틱서치의 데이터 분산 처리 과정
### 8.1.1 쓰기 작업 시 엘라스틱서치 동작과 동시성 제어
### 8.1.2 읽기 작업 시 엘라스틱서치 동작
### 8.1.3 체크포인트와 샤드 복구 과정
## 8.2 엘라스틱서치의 검색 동작 상세
### 8.2.1 엘라스틱서치 검색 동작 흐름
### 8.2.2 루씬 쿼리의 매칭과 스코어링 과정
### 8.2.3 캐시 동작

# 09장: 커스텀 플러그인을 이용한 엘라스틱서치 커스터마이징과 실전 운영
## 9.1 커스텀 플러그인이 필요한 이유
## 9.2 플러그인 기본
### 9.2.1 플러그인 기본 관리
### 9.2.2 플러그인 기본 구조
### 9.2.3 플러그인 개발 시 유의할 사항
## 9.3 Hello World 플러그인 제작
### 9.3.1 플러그인 프로젝트 생성과 기본 구조 잡기
### 9.3.2 Plugin과 ActionPlugin
## 9.4 엘라스틱서치와 플러그인의 테스트 코드 작성
### 9.4.1 테스트 코드 작성을 위한 기본 설정
### 9.4.2 엘라스틱서치 테스트 프레임워크로 테스트 코드 작성
### 9.4.3 REST 레이어 테스트
## 9.5 ActionFilter로 위험한 액션 차단 및 변조하기
### 9.5.1 ActionFilter를 사용하는 플러그인 구현
### 9.5.2 엘라스틱서치 기동 과정과 ActionFilter의 동작 상세
### 9.5.3 createComponents로 플러그인 구성요소 등록
### 9.5.4 LifecycleComponent로 생명 주기를 가진 구성요소 관리
## 9.6 특정 조건을 만족할 때를 감지하여 알람 보내기
### 9.6.1 persistent 타입의 task 동작
### 9.6.2 PersistentTaskPlugin 구현
### 9.6.3 플러그인에 권한 부여하기
## 9.7 인덱스 내 일부 데이터만 덤프하기
### 9.7.1 덤프 플러그인 작성
### 9.7.2 플러그인에 권한을 강제로 부여하기
### 9.7.3 HDFS에 덤프
## 9.8 데이터 변경분을 카프카로 발급하기
### 9.8.1 IndexingOperationListener로 문서 작업 추적
### 9.8.2 카프카로 메시지 발급
